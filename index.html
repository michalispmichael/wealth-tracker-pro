<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WealthTracker Pro</title>
    
    <!-- External Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .nav-item.active { background: #3b82f6; color: white; }
        .nav-item:hover { background: #f3f4f6; }
        .nav-item.active:hover { background: #2563eb; }
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="loading-spinner border-4 border-blue-200 border-t-blue-600 rounded-full w-12 h-12 mx-auto mb-4"></div>
            <p class="text-gray-600 font-medium">Loading WealthTracker Pro...</p>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-40">
        <div class="bg-white rounded-2xl w-full max-w-md">
            <div class="p-8">
                <div class="text-center mb-8">
                    <div class="mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4">
                        <i data-lucide="trending-up" class="w-8 h-8 text-blue-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900">WealthTracker Pro</h2>
                    <p class="text-gray-600 mt-2">Sign in to manage your finances</p>
                </div>

                <div class="space-y-4">
                    <button id="googleSignInBtn" class="w-full border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-3 rounded-lg transition-colors flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24">
                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        Continue with Google
                    </button>
                    
                    <div class="text-center mt-4">
                        <button id="demoModeBtn" class="text-sm text-blue-600 hover:text-blue-800">Continue in Demo Mode</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="hidden">
        <!-- Sidebar -->
        <div class="fixed inset-y-0 left-0 z-30 w-64 bg-white shadow-xl">
            <div class="flex h-full flex-col">
                <!-- Logo -->
                <div class="flex h-16 items-center justify-center px-6 gradient-bg">
                    <div class="flex items-center space-x-3">
                        <div class="p-2 bg-white/20 rounded-lg">
                            <i data-lucide="trending-up" class="w-6 h-6 text-white"></i>
                        </div>
                        <span class="text-xl font-bold text-white">WealthTracker Pro</span>
                    </div>
                </div>

                <!-- Navigation -->
                <nav class="flex-1 px-4 py-4 space-y-2">
                    <button data-tab="dashboard" class="nav-item active w-full flex items-center space-x-3 px-3 py-2 text-sm font-medium rounded-lg">
                        <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                        <span>Dashboard</span>
                    </button>
                    <button data-tab="capital-markets" class="nav-item w-full flex items-center space-x-3 px-3 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-50">
                        <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                        <span>Capital Markets</span>
                    </button>
                    <button data-tab="real-estate" class="nav-item w-full flex items-center space-x-3 px-3 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-50">
                        <i data-lucide="home" class="w-5 h-5"></i>
                        <span>Real Estate</span>
                    </button>
                    <button data-tab="accounts" class="nav-item w-full flex items-center space-x-3 px-3 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-50">
                        <i data-lucide="credit-card" class="w-5 h-5"></i>
                        <span>Bank Accounts</span>
                    </button>
                    <button data-tab="liabilities" class="nav-item w-full flex items-center space-x-3 px-3 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-50">
                        <i data-lucide="minus-circle" class="w-5 h-5"></i>
                        <span>Liabilities</span>
                    </button>
                    <button data-tab="income" class="nav-item w-full flex items-center space-x-3 px-3 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-50">
                        <i data-lucide="dollar-sign" class="w-5 h-5"></i>
                        <span>Income</span>
                    </button>
                    <button data-tab="expenses" class="nav-item w-full flex items-center space-x-3 px-3 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-50">
                        <i data-lucide="receipt" class="w-5 h-5"></i>
                        <span>Expenses</span>
                    </button>
                </nav>

                <!-- Logout -->
                <div class="p-4 border-t">
                    <button id="logoutBtn" class="w-full flex items-center justify-center space-x-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors">
                        <i data-lucide="log-out" class="w-4 h-4"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="ml-64 min-h-screen">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b sticky top-0 z-20">
                <div class="px-6 py-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900" id="pageTitle">Dashboard</h1>
                            <p class="text-sm text-gray-500">Welcome to your financial overview</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <button id="addItemBtn" class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span>Add Item</span>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <main class="p-6">
                <!-- Dashboard Tab -->
                <div id="dashboard-content" class="tab-content active">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-500">Net Worth</p>
                                    <p class="text-2xl font-bold text-gray-900" id="netWorthValue">â‚¬0</p>
                                    <p class="text-sm text-green-600 mt-1">Total Wealth</p>
                                </div>
                                <div class="p-3 bg-blue-50 rounded-xl">
                                    <i data-lucide="trending-up" class="w-6 h-6 text-blue-600"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-500">Total Assets</p>
                                    <p class="text-2xl font-bold text-gray-900" id="totalAssetsValue">â‚¬0</p>
                                    <p class="text-sm text-gray-500 mt-1">All Holdings</p>
                                </div>
                                <div class="p-3 bg-green-50 rounded-xl">
                                    <i data-lucide="arrow-up-right" class="w-6 h-6 text-green-600"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-500">Monthly Balance</p>
                                    <p class="text-2xl font-bold text-gray-900" id="monthlyBalanceValue">â‚¬0</p>
                                    <p class="text-sm text-gray-500 mt-1">Income - Expenses</p>
                                </div>
                                <div class="p-3 bg-purple-50 rounded-xl">
                                    <i data-lucide="calculator" class="w-6 h-6 text-purple-600"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Portfolio Summary</h3>
                        <div id="portfolioSummary" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="text-center">
                                <p class="text-sm text-gray-500">Capital Markets</p>
                                <p class="text-xl font-bold text-blue-600" id="capitalMarketsTotal">â‚¬0</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-500">Real Estate</p>
                                <p class="text-xl font-bold text-green-600" id="realEstateTotal">â‚¬0</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-500">Bank Accounts</p>
                                <p class="text-xl font-bold text-purple-600" id="accountsTotal">â‚¬0</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-gray-500">Total Liabilities</p>
                                <p class="text-xl font-bold text-red-600" id="liabilitiesTotal">â‚¬0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Capital Markets Tab -->
                <div id="capital-markets-content" class="tab-content">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900">Capital Markets Portfolio</h3>
                            <button id="addCapitalMarketBtn" class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span>Add Investment</span>
                            </button>
                        </div>
                        <div class="p-6" id="capitalMarketsContainer">
                            <div class="text-center text-gray-500 py-8">
                                <i data-lucide="bar-chart-3" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                <p>No investments added yet</p>
                                <p class="text-sm">Click "Add Investment" to get started</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Real Estate Tab -->
                <div id="real-estate-content" class="tab-content">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900">Real Estate Portfolio</h3>
                            <button id="addRealEstateBtn" class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span>Add Property</span>
                            </button>
                        </div>
                        <div class="p-6" id="realEstateContainer">
                            <div class="text-center text-gray-500 py-8">
                                <i data-lucide="home" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                <p>No properties added yet</p>
                                <p class="text-sm">Click "Add Property" to get started</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Accounts Tab -->
                <div id="accounts-content" class="tab-content">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900">Bank Accounts</h3>
                            <button id="addAccountBtn" class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span>Add Account</span>
                            </button>
                        </div>
                        <div class="p-6" id="accountsContainer">
                            <div class="text-center text-gray-500 py-8">
                                <i data-lucide="credit-card" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                <p>No accounts added yet</p>
                                <p class="text-sm">Click "Add Account" to get started</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Liabilities Tab -->
                <div id="liabilities-content" class="tab-content">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900">Liabilities & Debts</h3>
                            <button id="addLiabilityBtn" class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span>Add Liability</span>
                            </button>
                        </div>
                        <div class="p-6" id="liabilitiesContainer">
                            <div class="text-center text-gray-500 py-8">
                                <i data-lucide="minus-circle" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                <p>No liabilities added yet</p>
                                <p class="text-sm">Click "Add Liability" to get started</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Income Tab -->
                <div id="income-content" class="tab-content">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900">Income Sources</h3>
                            <button id="addIncomeBtn" class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span>Add Income</span>
                            </button>
                        </div>
                        <div class="p-6" id="incomeContainer">
                            <div class="text-center text-gray-500 py-8">
                                <i data-lucide="dollar-sign" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                <p>No income sources added yet</p>
                                <p class="text-sm">Click "Add Income" to get started</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Expenses Tab -->
                <div id="expenses-content" class="tab-content">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900">Expenses</h3>
                            <button id="addExpenseBtn" class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span>Add Expense</span>
                            </button>
                        </div>
                        <div class="p-6" id="expensesContainer">
                            <div class="text-center text-gray-500 py-8">
                                <i data-lucide="receipt" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                <p>No expenses added yet</p>
                                <p class="text-sm">Click "Add Expense" to get started</p>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Universal Modal -->
    <div id="addModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900" id="modalTitle">Add Item</h3>
                    <button id="closeModal" class="text-gray-400 hover:text-gray-600">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6" id="modalBody">
                <!-- Form content will be inserted here -->
            </div>
            
            <div class="p-6 border-t border-gray-200 flex space-x-3">
                <button id="cancelModal" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">Cancel</button>
                <button id="saveModal" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">Save</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // ðŸ”¥ FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyDOi3pkTY7Nof19auZkLzs4KnhJ8DTPqwI",
            authDomain: "wealth-tracker-app-4209f.firebaseapp.com",
            projectId: "wealth-tracker-app-4209f",
            storageBucket: "wealth-tracker-app-4209f.firebasestorage.app",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };

        // Initialize Firebase
        let auth, db, provider;
        try {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            provider = new firebase.auth.GoogleAuthProvider();
            console.log('âœ… Firebase initialized successfully');
        } catch (error) {
            console.log('âš ï¸ Firebase not available, using localStorage only');
        }

        // ðŸ“± GLOBAL STATE
        let currentUser = null;
        let activeTab = 'dashboard';
        let currentCurrency = 'EUR';
        let isDemoMode = false;

        // ðŸŽ¯ DATA STORAGE SYSTEM
        class DataManager {
            static getStorageKey(type) {
                const prefix = isDemoMode ? 'demo_' : (currentUser ? currentUser.uid + '_' : 'local_');
                return prefix + type;
            }

            static async saveData(type, data) {
                console.log('ðŸ’¾ Saving data:', type, data);
                
                try {
                    if (!isDemoMode && currentUser && db) {
                        // Save to Firebase
                        const docRef = await db.collection('users').doc(currentUser.uid).collection(type).add(data);
                        data.id = docRef.id;
                        console.log('âœ… Saved to Firebase:', type, data.id);
                    } else {
                        // Save to localStorage
                        const storageKey = this.getStorageKey(type);
                        const existingData = JSON.parse(localStorage.getItem(storageKey) || '[]');
                        data.id = Date.now().toString() + '_' + Math.random().toString(36).substr(2, 9);
                        existingData.push(data);
                        localStorage.setItem(storageKey, JSON.stringify(existingData));
                        console.log('âœ… Saved to localStorage:', storageKey, data.id);
                    }
                    return data;
                } catch (error) {
                    console.error('âŒ Error saving data:', error);
                    throw error;
                }
            }

            static async loadData(type) {
                console.log('ðŸ“¥ Loading data:', type);
                
                try {
                    if (!isDemoMode && currentUser && db) {
                        // Load from Firebase
                        const snapshot = await db.collection('users').doc(currentUser.uid).collection(type).get();
                        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        console.log('âœ… Loaded from Firebase:', type, data.length, 'items');
                        return data;
                    } else {
                        // Load from localStorage
                        const storageKey = this.getStorageKey(type);
                        const data = JSON.parse(localStorage.getItem(storageKey) || '[]');
                        console.log('âœ… Loaded from localStorage:', storageKey, data.length, 'items');
                        return data;
                    }
                } catch (error) {
                    console.error('âŒ Error loading data:', error);
                    return [];
                }
            }

            static async deleteData(type, id) {
                console.log('ðŸ—‘ï¸ Deleting data:', type, id);
                
                try {
                    if (!isDemoMode && currentUser && db) {
                        // Delete from Firebase
                        await db.collection('users').doc(currentUser.uid).collection(type).doc(id).delete();
                        console.log('âœ… Deleted from Firebase:', type, id);
                    } else {
                        // Delete from localStorage
                        const storageKey = this.getStorageKey(type);
                        const existingData = JSON.parse(localStorage.getItem(storageKey) || '[]');
                        const filteredData = existingData.filter(item => item.id !== id);
                        localStorage.setItem(storageKey, JSON.stringify(filteredData));
                        console.log('âœ… Deleted from localStorage:', storageKey, id);
                    }
                } catch (error) {
                    console.error('âŒ Error deleting data:', error);
                    throw error;
                }
            }
        }

        // ðŸ› ï¸ UTILITY FUNCTIONS
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-EU', {
                style: 'currency',
                currency: currentCurrency
            }).format(amount || 0);
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `px-6 py-3 rounded-lg text-white font-medium shadow-lg transform transition-all duration-300 ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            }`;
            toast.textContent = message;
            
            document.getElementById('toastContainer').appendChild(toast);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function createIcons() {
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            }
        }

        // ðŸŽ® NAVIGATION SYSTEM
        function switchTab(tabName) {
            console.log('ðŸ”„ Switching to tab:', tabName);
            activeTab = tabName;

            // Update navigation
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('text-gray-600');
            });

            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.classList.remove('text-gray-600');
            }

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            const currentContent = document.getElementById(`${tabName}-content`);
            if (currentContent) {
                currentContent.classList.add('active');
            }

            // Update page title
            document.getElementById('pageTitle').textContent = 
                tabName.charAt(0).toUpperCase() + tabName.slice(1).replace('-', ' ');

            // Load data for this tab
            if (tabName !== 'dashboard') {
                renderTabContent(tabName);
            }
        }

        // ðŸ“‹ MODAL SYSTEM
        function openModal(type) {
            console.log('ðŸŽ¯ Opening modal for:', type);
            
            const modal = document.getElementById('addModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            const modalConfigs = {
                'capital-markets': {
                    title: 'Add Capital Market Investment',
                    form: `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Investment Name</label>
                                <input type="text" id="form_name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Apple Stock, Bitcoin" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                <select id="form_type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="stock">Stock</option>
                                    <option value="etf">ETF</option>
                                    <option value="crypto">Cryptocurrency</option>
                                    <option value="bond">Bond</option>
                                    <option value="mutual_fund">Mutual Fund</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
                                    <input type="number" id="form_quantity" step="0.001" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="100" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Purchase Price</label>
                                    <input type="number" id="form_purchase_price" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="150.00" required>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Current Value (optional)</label>
                                <input type="number" id="form_current_value" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="15500.00">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Risk Level</label>
                                <select id="form_risk_level" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="low">Low Risk</option>
                                    <option value="medium">Medium Risk</option>
                                    <option value="high">High Risk</option>
                                </select>
                            </div>
                        </div>
                    `
                },
                'real-estate': {
                    title: 'Add Real Estate Property',
                    form: `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Property Name</label>
                                <input type="text" id="form_name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Downtown Apartment" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                <select id="form_type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="residential">Residential</option>
                                    <option value="commercial">Commercial</option>
                                    <option value="land">Land</option>
                                    <option value="rental">Rental Property</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Purchase Price</label>
                                <input type="number" id="form_purchase_price" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="250000" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Current Value</label>
                                <input type="number" id="form_current_value" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="270000">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Monthly Rental Income (if applicable)</label>
                                <input type="number" id="form_monthly_rental" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1200">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                                <input type="text" id="form_location" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Athens, Greece">
                            </div>
                        </div>
                    `
                },
                'accounts': {
                    title: 'Add Bank Account',
                    form: `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Account Name</label>
                                <input type="text" id="form_name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Main Checking Account" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Bank</label>
                                <input type="text" id="form_bank" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., National Bank">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Account Type</label>
                                <select id="form_type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="checking">Checking</option>
                                    <option value="savings">Savings</option>
                                    <option value="deposit">Term Deposit</option>
                                    <option value="business">Business</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Current Balance</label>
                                <input type="number" id="form_balance" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="5000" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Interest Rate (%)</label>
                                <input type="number" id="form_interest_rate" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="2.5">
                            </div>
                        </div>
                    `
                },
                'liabilities': {
                    title: 'Add Liability/Debt',
                    form: `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Liability Name</label>
                                <input type="text" id="form_name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Home Mortgage" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                <select id="form_type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="mortgage">Mortgage</option>
                                    <option value="loan">Personal Loan</option>
                                    <option value="credit_card">Credit Card</option>
                                    <option value="student_loan">Student Loan</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Outstanding Balance</label>
                                <input type="number" id="form_balance" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="150000" required>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Interest Rate (%)</label>
                                    <input type="number" id="form_interest_rate" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="3.5">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Monthly Payment</label>
                                    <input type="number" id="form_monthly_payment" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1200">
                                </div>
                            </div>
                        </div>
                    `
                },
                'income': {
                    title: 'Add Income Source',
                    form: `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Income Source</label>
                                <input type="text" id="form_name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Salary, Freelance" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                <select id="form_type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="salary">Salary</option>
                                    <option value="freelance">Freelance</option>
                                    <option value="business">Business</option>
                                    <option value="rental">Rental Income</option>
                                    <option value="dividends">Dividends</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Monthly Amount</label>
                                <input type="number" id="form_monthly_amount" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="3500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">After Tax Amount</label>
                                <input type="number" id="form_after_tax_amount" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="2800">
                            </div>
                        </div>
                    `
                },
                'expenses': {
                    title: 'Add Expense',
                    form: `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Expense Description</label>
                                <input type="text" id="form_name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Groceries, Rent" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                <select id="form_category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="housing">Housing</option>
                                    <option value="food">Food & Dining</option>
                                    <option value="transportation">Transportation</option>
                                    <option value="utilities">Utilities</option>
                                    <option value="entertainment">Entertainment</option>
                                    <option value="health">Health</option>
                                    <option value="shopping">Shopping</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Amount</label>
                                <input type="number" id="form_amount" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="250" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Frequency</label>
                                <select id="form_frequency" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="monthly">Monthly</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="daily">Daily</option>
                                    <option value="yearly">Yearly</option>
                                    <option value="one-time">One-time</option>
                                </select>
                            </div>
                        </div>
                    `
                }
            };

            const config = modalConfigs[type];
            if (!config) {
                showToast('Unknown item type', 'error');
                return;
            }

            modalTitle.textContent = config.title;
            modalBody.innerHTML = config.form;
            modal.setAttribute('data-type', type);
            modal.classList.remove('hidden');

            // Focus first input
            setTimeout(() => {
                const firstInput = modalBody.querySelector('input');
                if (firstInput) firstInput.focus();
            }, 100);

            console.log('âœ… Modal opened for:', type);
        }

        function closeModal() {
            const modal = document.getElementById('addModal');
            modal.classList.add('hidden');
            modal.removeAttribute('data-type');
        }

        // ðŸ’¾ SAVE SYSTEM
        async function saveModalData() {
            const modal = document.getElementById('addModal');
            const saveBtn = document.getElementById('saveModal');
            const type = modal.getAttribute('data-type');

            if (!type) {
                showToast('Error: No item type specified', 'error');
                return;
            }

            // Show loading state
            const originalText = saveBtn.textContent;
            saveBtn.textContent = 'Saving...';
            saveBtn.disabled = true;

            try {
                console.log('ðŸ’¾ Collecting form data for:', type);

                // Collect form data
                const formData = {
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                // Get form values based on type
                const nameField = document.getElementById('form_name');
                if (!nameField || !nameField.value.trim()) {
                    throw new Error('Please enter a name');
                }
                formData.name = nameField.value.trim();

                // Type-specific field collection
                switch (type) {
                    case 'capital-markets':
                        formData.type = document.getElementById('form_type').value;
                        formData.quantity = parseFloat(document.getElementById('form_quantity').value) || 0;
                        formData.purchasePrice = parseFloat(document.getElementById('form_purchase_price').value) || 0;
                        formData.currentValue = parseFloat(document.getElementById('form_current_value').value) || null;
                        formData.riskLevel = document.getElementById('form_risk_level').value;
                        break;

                    case 'real-estate':
                        formData.type = document.getElementById('form_type').value;
                        formData.purchasePrice = parseFloat(document.getElementById('form_purchase_price').value) || 0;
                        formData.currentValue = parseFloat(document.getElementById('form_current_value').value) || formData.purchasePrice;
                        formData.monthlyRental = parseFloat(document.getElementById('form_monthly_rental').value) || 0;
                        formData.location = document.getElementById('form_location').value || '';
                        break;

                    case 'accounts':
                        formData.bank = document.getElementById('form_bank').value || '';
                        formData.type = document.getElementById('form_type').value;
                        formData.balance = parseFloat(document.getElementById('form_balance').value) || 0;
                        formData.interestRate = parseFloat(document.getElementById('form_interest_rate').value) || 0;
                        break;

                    case 'liabilities':
                        formData.type = document.getElementById('form_type').value;
                        formData.balance = parseFloat(document.getElementById('form_balance').value) || 0;
                        formData.interestRate = parseFloat(document.getElementById('form_interest_rate').value) || 0;
                        formData.monthlyPayment = parseFloat(document.getElementById('form_monthly_payment').value) || 0;
                        break;

                    case 'income':
                        formData.type = document.getElementById('form_type').value;
                        formData.monthlyAmount = parseFloat(document.getElementById('form_monthly_amount').value) || 0;
                        formData.afterTaxAmount = parseFloat(document.getElementById('form_after_tax_amount').value) || formData.monthlyAmount;
                        break;

                    case 'expenses':
                        formData.category = document.getElementById('form_category').value;
                        formData.amount = parseFloat(document.getElementById('form_amount').value) || 0;
                        formData.frequency = document.getElementById('form_frequency').value;
                        break;
                }

                console.log('ðŸ“ Form data collected:', formData);

                // Save data
                const savedData = await DataManager.saveData(type, formData);
                console.log('âœ… Data saved successfully:', savedData);

                showToast(`${type.replace('-', ' ')} added successfully!`, 'success');
                closeModal();
                
                // Refresh current view
                if (activeTab === 'dashboard') {
                    await updateDashboard();
                } else {
                    await renderTabContent(activeTab);
                }

            } catch (error) {
                console.error('âŒ Error saving data:', error);
                showToast(error.message || 'Error saving item', 'error');
            } finally {
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
            }
        }

        // ðŸ“Š DATA RENDERING SYSTEM
        async function renderTabContent(tabName) {
            console.log('ðŸŽ¨ Rendering content for:', tabName);
            
            const data = await DataManager.loadData(tabName);
            const containerId = `${tabName.replace('-', '')}Container`;
            const container = document.getElementById(containerId);

            if (!container) {
                console.warn('Container not found:', containerId);
                return;
            }

            if (data.length === 0) {
                // Show empty state
                const iconMap = {
                    'capital-markets': 'bar-chart-3',
                    'real-estate': 'home',
                    'accounts': 'credit-card',
                    'liabilities': 'minus-circle',
                    'income': 'dollar-sign',
                    'expenses': 'receipt'
                };

                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i data-lucide="${iconMap[tabName]}" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                        <p>No ${tabName.replace('-', ' ')} added yet</p>
                        <p class="text-sm">Click "Add" to get started</p>
                    </div>
                `;
                createIcons();
                return;
            }

            // Render data items
            let itemsHtml = '<div class="space-y-4">';
            
            data.forEach(item => {
                let valueDisplay = '';
                let detailsDisplay = '';

                switch (tabName) {
                    case 'capital-markets':
                        const totalValue = item.currentValue || (item.quantity * item.purchasePrice);
                        valueDisplay = formatCurrency(totalValue);
                        detailsDisplay = `${item.quantity} shares â€¢ ${item.type} â€¢ ${item.riskLevel} risk`;
                        break;
                    case 'real-estate':
                        valueDisplay = formatCurrency(item.currentValue || item.purchasePrice);
                        detailsDisplay = `${item.type} ${item.location ? 'â€¢ ' + item.location : ''}`;
                        if (item.monthlyRental > 0) detailsDisplay += ` â€¢ ${formatCurrency(item.monthlyRental)}/month`;
                        break;
                    case 'accounts':
                        valueDisplay = formatCurrency(item.balance);
                        detailsDisplay = `${item.bank} â€¢ ${item.type}`;
                        if (item.interestRate > 0) detailsDisplay += ` â€¢ ${item.interestRate}% APY`;
                        break;
                    case 'liabilities':
                        valueDisplay = formatCurrency(item.balance);
                        detailsDisplay = `${item.type}`;
                        if (item.interestRate > 0) detailsDisplay += ` â€¢ ${item.interestRate}%`;
                        if (item.monthlyPayment > 0) detailsDisplay += ` â€¢ ${formatCurrency(item.monthlyPayment)}/month`;
                        break;
                    case 'income':
                        valueDisplay = formatCurrency(item.afterTaxAmount || item.monthlyAmount);
                        detailsDisplay = `${item.type} â€¢ Monthly`;
                        break;
                    case 'expenses':
                        valueDisplay = formatCurrency(item.amount);
                        detailsDisplay = `${item.category} â€¢ ${item.frequency}`;
                        break;
                }

                itemsHtml += `
                    <div class="bg-gray-50 rounded-lg p-4 flex justify-between items-center hover:bg-gray-100 transition-colors">
                        <div>
                            <h4 class="font-medium text-gray-900">${item.name}</h4>
                            <p class="text-sm text-gray-500">${detailsDisplay}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-gray-900">${valueDisplay}</p>
                            <div class="flex space-x-2 mt-1">
                                <button onclick="deleteItem('${tabName}', '${item.id}')" class="text-red-600 hover:text-red-800 text-sm font-medium">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            itemsHtml += '</div>';
            container.innerHTML = itemsHtml;

            console.log('âœ… Rendered', data.length, 'items for', tabName);
        }

        // ðŸ—‘ï¸ DELETE FUNCTION
        window.deleteItem = async function(type, id) {
            if (!confirm('Are you sure you want to delete this item?')) return;
            
            try {
                await DataManager.deleteData(type, id);
                showToast('Item deleted successfully!', 'success');
                
                if (activeTab === 'dashboard') {
                    await updateDashboard();
                } else {
                    await renderTabContent(activeTab);
                }
            } catch (error) {
                console.error('âŒ Error deleting item:', error);
                showToast('Error deleting item', 'error');
            }
        };

        // ðŸ“ˆ DASHBOARD UPDATE SYSTEM
        async function updateDashboard() {
            console.log('ðŸ“Š Updating dashboard...');
            
            try {
                // Load all data
                const [capitalMarkets, realEstate, accounts, liabilities, income, expenses] = await Promise.all([
                    DataManager.loadData('capital-markets'),
                    DataManager.loadData('real-estate'),
                    DataManager.loadData('accounts'),
                    DataManager.loadData('liabilities'),
                    DataManager.loadData('income'),
                    DataManager.loadData('expenses')
                ]);

                // Calculate totals
                let totalCapitalMarkets = 0;
                let totalRealEstate = 0;
                let totalAccounts = 0;
                let totalLiabilities = 0;
                let monthlyIncome = 0;
                let monthlyExpenses = 0;

                // Capital Markets
                capitalMarkets.forEach(item => {
                    const value = item.currentValue || (item.quantity * item.purchasePrice);
                    totalCapitalMarkets += value || 0;
                });

                // Real Estate
                realEstate.forEach(item => {
                    totalRealEstate += item.currentValue || item.purchasePrice || 0;
                });

                // Accounts
                accounts.forEach(item => {
                    totalAccounts += item.balance || 0;
                });

                // Liabilities
                liabilities.forEach(item => {
                    totalLiabilities += item.balance || 0;
                });

                // Income
                income.forEach(item => {
                    monthlyIncome += item.afterTaxAmount || item.monthlyAmount || 0;
                });

                // Expenses
                expenses.forEach(item => {
                    let monthlyAmount = item.amount || 0;
                    if (item.frequency === 'weekly') monthlyAmount *= 4.33;
                    else if (item.frequency === 'yearly') monthlyAmount /= 12;
                    else if (item.frequency === 'daily') monthlyAmount *= 30;
                    monthlyExpenses += monthlyAmount;
                });

                const totalAssets = totalCapitalMarkets + totalRealEstate + totalAccounts;
                const netWorth = totalAssets - totalLiabilities;
                const monthlyBalance = monthlyIncome - monthlyExpenses;

                // Update main dashboard values
                document.getElementById('netWorthValue').textContent = formatCurrency(netWorth);
                document.getElementById('totalAssetsValue').textContent = formatCurrency(totalAssets);
                document.getElementById('monthlyBalanceValue').textContent = formatCurrency(monthlyBalance);

                // Update portfolio summary
                document.getElementById('capitalMarketsTotal').textContent = formatCurrency(totalCapitalMarkets);
                document.getElementById('realEstateTotal').textContent = formatCurrency(totalRealEstate);
                document.getElementById('accountsTotal').textContent = formatCurrency(totalAccounts);
                document.getElementById('liabilitiesTotal').textContent = formatCurrency(totalLiabilities);

                console.log('âœ… Dashboard updated:', {
                    netWorth, totalAssets, monthlyBalance,
                    breakdown: { totalCapitalMarkets, totalRealEstate, totalAccounts, totalLiabilities }
                });

            } catch (error) {
                console.error('âŒ Error updating dashboard:', error);
            }
        }

        // ðŸ” AUTHENTICATION SYSTEM
        async function signInWithGoogle() {
            try {
                console.log('ðŸ”„ Attempting Google sign-in...');
                const result = await auth.signInWithPopup(provider);
                console.log('âœ… Google sign-in successful:', result.user.email);
                showToast('Successfully signed in with Google!', 'success');
            } catch (error) {
                console.error('âŒ Google sign-in error:', error);
                showToast('Error signing in: ' + error.message, 'error');
            }
        }

        function enterDemoMode() {
            console.log('ðŸŽ¯ Entering demo mode');
            isDemoMode = true;
            currentUser = { uid: 'demo', email: 'demo@example.com' };
            showToast('Demo mode activated!', 'success');
            showApp();
            updateDashboard();
        }

        function signOut() {
            if (isDemoMode) {
                isDemoMode = false;
                currentUser = null;
                showLogin();
                showToast('Demo mode ended', 'success');
            } else if (auth) {
                auth.signOut().then(() => {
                    console.log('âœ… User signed out');
                    showToast('Signed out successfully', 'success');
                }).catch((error) => {
                    console.error('âŒ Sign out error:', error);
                    showToast('Error signing out', 'error');
                });
            }
        }

        function showApp() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
        }

        function showLogin() {
            document.getElementById('app').classList.add('hidden');
            document.getElementById('loginModal').classList.remove('hidden');
        }

        // ðŸš€ INITIALIZATION
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ðŸš€ WealthTracker Pro starting...');

            try {
                // Initialize Lucide icons
                createIcons();

                // Setup Navigation
                document.querySelectorAll('.nav-item').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const tabName = btn.getAttribute('data-tab');
                        switchTab(tabName);
                    });
                });

                // Setup Authentication
                if (auth) {
                    auth.onAuthStateChanged((user) => {
                        currentUser = user;
                        if (user && !isDemoMode) {
                            console.log('âœ… User authenticated:', user.email);
                            showApp();
                            updateDashboard();
                        } else if (!isDemoMode) {
                            console.log('ðŸ” No user authenticated');
                            showLogin();
                        }
                    });
                }

                document.getElementById('googleSignInBtn').addEventListener('click', signInWithGoogle);
                document.getElementById('demoModeBtn').addEventListener('click', enterDemoMode);
                document.getElementById('logoutBtn').addEventListener('click', signOut);

                // Setup Modal System
                document.getElementById('closeModal').addEventListener('click', closeModal);
                document.getElementById('cancelModal').addEventListener('click', closeModal);
                document.getElementById('saveModal').addEventListener('click', saveModalData);

                // Setup Add Buttons
                document.getElementById('addItemBtn').addEventListener('click', () => {
                    if (activeTab !== 'dashboard') {
                        openModal(activeTab);
                    } else {
                        showToast('Please navigate to a specific section to add items', 'error');
                    }
                });

                // Specific add buttons
                document.getElementById('addCapitalMarketBtn').addEventListener('click', () => openModal('capital-markets'));
                document.getElementById('addRealEstateBtn').addEventListener('click', () => openModal('real-estate'));
                document.getElementById('addAccountBtn').addEventListener('click', () => openModal('accounts'));
                document.getElementById('addLiabilityBtn').addEventListener('click', () => openModal('liabilities'));
                document.getElementById('addIncomeBtn').addEventListener('click', () => openModal('income'));
                document.getElementById('addExpenseBtn').addEventListener('click', () => openModal('expenses'));

                console.log('âœ… Event listeners attached');

                // Hide loading screen
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    if (!auth) {
                        showLogin();
                    }
                }, 1500);

            } catch (error) {
                console.error('âŒ Initialization error:', error);
                showToast('Error initializing app: ' + error.message, 'error');
            }
        });

        console.log('ðŸŽ¯ WealthTracker Pro script loaded successfully!');
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WealthTracker Pro</title>
    
    <!-- External Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .nav-item.active { background: #3b82f6; color: white; }
        .nav-item:hover { background: #f3f4f6; }
        .nav-item.active:hover { background: #2563eb; }
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .dropdown-menu { display: none; }
        .dropdown-menu.active { display: block; }
        .dropdown-item { padding: 8px 16px; cursor: pointer; transition: background 0.2s; }
        .dropdown-item:hover { background: #f3f4f6; }
        .dropdown-item.active { background: #3b82f6; color: white; }
        .risk-indicator { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }
        .risk-low { background: #10b981; }
        .risk-medium { background: #f59e0b; }
        .risk-high { background: #ef4444; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="loading-spinner border-4 border-blue-200 border-t-blue-600 rounded-full w-12 h-12 mx-auto mb-4"></div>
            <p class="text-gray-600 font-medium">Loading WealthTracker Pro...</p>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-40">
        <div class="bg-white rounded-2xl w-full max-w-md">
            <div class="p-8">
                <div class="text-center mb-8">
                    <div class="mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4">
                        <i data-lucide="trending-up" class="w-8 h-8 text-blue-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900">WealthTracker Pro</h2>
                    <p class="text-gray-600 mt-2" data-translate="login.subtitle">Sign in to manage your finances</p>
                </div>

                <div class="space-y-4">
                    <button id="googleSignInBtn" class="w-full border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-3 rounded-lg transition-colors flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24">
                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        <span data-translate="login.google">Continue with Google</span>
                    </button>
                    
                    <div class="text-center mt-4">
                        <button id="demoModeBtn" class="text-sm text-blue-600 hover:text-blue-800" data-translate="login.demo">Continue in Demo Mode</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="hidden">
        <!-- Sidebar -->
        <div class="fixed inset-y-0 left-0 z-30 w-64 bg-white shadow-xl">
            <div class="flex h-full flex-col">
                <!-- Logo -->
                <div class="flex h-16 items-center justify-center px-6 gradient-bg">
                    <div class="flex items-center space-x-3">
                        <div class="p-2 bg-white/20 rounded-lg">
                            <i data-lucide="trending-up" class="w-6 h-6 text-white"></i>
                        </div>
                        <span class="text-xl font-bold text-white">WealthTracker Pro</span>
                    </div>
                </div>

                <!-- Language Toggle -->
                <div class="px-4 py-2 border-b border-gray-200">
                    <select id="languageSelect" class="w-full px-3 py-1 text-sm border border-gray-300 rounded">
                        <option value="en">English</option>
                        <option value="el">Ελληνικά</option>
                    </select>
                </div>

                <!-- Navigation -->
                <nav class="flex-1 px-4 py-4 space-y-2">
                    <!-- Dashboard -->
                    <button data-tab="dashboard" class="nav-item active w-full flex items-center space-x-3 px-3 py-2 text-sm font-medium rounded-lg">
                        <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                        <span data-translate="nav.dashboard">Dashboard & Analytics</span>
                    </button>

                    <!-- Assets Dropdown -->
                    <div class="relative">
                        <button id="assetsDropdown" class="nav-item w-full flex items-center justify-between space-x-3 px-3 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-50">
                            <div class="flex items-center space-x-3">
                                <i data-lucide="briefcase" class="w-5 h-5"></i>
                                <span data-translate="nav.assets">Assets</span>
                            </div>
                            <i data-lucide="chevron-down" class="w-4 h-4"></i>
                        </button>
                        <div id="assetsDropdownMenu" class="dropdown-menu ml-6 mt-1 bg-white border border-gray-200 rounded-lg shadow-sm">
                            <div data-tab="capital-markets" class="dropdown-item text-sm" data-translate="nav.capital_markets">Capital Markets</div>
                            <div data-tab="real-estate" class="dropdown-item text-sm" data-translate="nav.real_estate">Real Estate</div>
                            <div data-tab="bank-accounts" class="dropdown-item text-sm" data-translate="nav.bank_accounts">Bank Accounts</div>
                            <div data-tab="other-assets" class="dropdown-item text-sm" data-translate="nav.other_assets">Other Assets</div>
                            <div data-tab="investments-overview" class="dropdown-item text-sm" data-translate="nav.investments_overview">Investments Overview</div>
                        </div>
                    </div>

                    <!-- Liabilities -->
                    <button data-tab="liabilities" class="nav-item w-full flex items-center space-x-3 px-3 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-50">
                        <i data-lucide="minus-circle" class="w-5 h-5"></i>
                        <span data-translate="nav.liabilities">Liabilities</span>
                    </button>

                    <!-- Cash Flow Dropdown -->
                    <div class="relative">
                        <button id="cashflowDropdown" class="nav-item w-full flex items-center justify-between space-x-3 px-3 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-50">
                            <div class="flex items-center space-x-3">
                                <i data-lucide="trending-up" class="w-5 h-5"></i>
                                <span data-translate="nav.cash_flow">Cash Flow</span>
                            </div>
                            <i data-lucide="chevron-down" class="w-4 h-4"></i>
                        </button>
                        <div id="cashflowDropdownMenu" class="dropdown-menu ml-6 mt-1 bg-white border border-gray-200 rounded-lg shadow-sm">
                            <div data-tab="income" class="dropdown-item text-sm" data-translate="nav.income">Income</div>
                            <div data-tab="expenses" class="dropdown-item text-sm" data-translate="nav.expenses">Expenses</div>
                            <div data-tab="cashflow-analysis" class="dropdown-item text-sm" data-translate="nav.cashflow_analysis">Cash Flow Analysis</div>
                        </div>
                    </div>
                </nav>

                <!-- Logout -->
                <div class="p-4 border-t">
                    <button id="logoutBtn" class="w-full flex items-center justify-center space-x-2 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors">
                        <i data-lucide="log-out" class="w-4 h-4"></i>
                        <span data-translate="nav.logout">Logout</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="ml-64 min-h-screen">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b sticky top-0 z-20">
                <div class="px-6 py-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900" id="pageTitle" data-translate="dashboard.title">Dashboard & Analytics</h1>
                            <p class="text-sm text-gray-500" id="pageSubtitle" data-translate="dashboard.subtitle">Welcome to your financial overview</p>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <main class="p-6">
                <!-- Dashboard Tab -->
                <div id="dashboard-content" class="tab-content active">
                    <!-- Key Metrics -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-500" data-translate="dashboard.net_worth">Net Worth</p>
                                    <p class="text-2xl font-bold text-gray-900" id="netWorthValue">€0</p>
                                    <p class="text-sm text-green-600 mt-1" data-translate="dashboard.total_wealth">Total Wealth</p>
                                </div>
                                <div class="p-3 bg-blue-50 rounded-xl">
                                    <i data-lucide="trending-up" class="w-6 h-6 text-blue-600"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-500" data-translate="dashboard.total_assets">Total Assets</p>
                                    <p class="text-2xl font-bold text-gray-900" id="totalAssetsValue">€0</p>
                                    <p class="text-sm text-gray-500 mt-1" data-translate="dashboard.all_holdings">All Holdings</p>
                                </div>
                                <div class="p-3 bg-green-50 rounded-xl">
                                    <i data-lucide="arrow-up-right" class="w-6 h-6 text-green-600"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-500" data-translate="dashboard.invested_capital">Invested Capital</p>
                                    <p class="text-2xl font-bold text-gray-900" id="investedCapitalValue">€0</p>
                                    <p class="text-sm text-purple-600 mt-1" data-translate="dashboard.growth_potential">Growth Potential</p>
                                </div>
                                <div class="p-3 bg-purple-50 rounded-xl">
                                    <i data-lucide="target" class="w-6 h-6 text-purple-600"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-500" data-translate="dashboard.monthly_balance">Monthly Balance</p>
                                    <p class="text-2xl font-bold text-gray-900" id="monthlyBalanceValue">€0</p>
                                    <p class="text-sm text-gray-500 mt-1" data-translate="dashboard.income_minus_expenses">Income - Expenses</p>
                                </div>
                                <div class="p-3 bg-yellow-50 rounded-xl">
                                    <i data-lucide="calculator" class="w-6 h-6 text-yellow-600"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Portfolio Overview -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4" data-translate="dashboard.portfolio_breakdown">Portfolio Breakdown</h3>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600" data-translate="dashboard.capital_markets">Capital Markets</span>
                                    <span class="font-bold text-blue-600" id="capitalMarketsTotal">€0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600" data-translate="dashboard.real_estate">Real Estate</span>
                                    <span class="font-bold text-green-600" id="realEstateTotal">€0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600" data-translate="dashboard.bank_accounts">Bank Accounts</span>
                                    <span class="font-bold text-purple-600" id="bankAccountsTotal">€0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600" data-translate="dashboard.other_assets">Other Assets</span>
                                    <span class="font-bold text-indigo-600" id="otherAssetsTotal">€0</span>
                                </div>
                                <div class="border-t pt-2">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600" data-translate="dashboard.total_liabilities">Total Liabilities</span>
                                        <span class="font-bold text-red-600" id="liabilitiesTotal">€0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4" data-translate="dashboard.risk_analysis">Risk Analysis</h3>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center space-x-2">
                                        <span class="risk-indicator risk-low"></span>
                                        <span class="text-sm text-gray-600" data-translate="dashboard.low_risk">Low Risk</span>
                                    </div>
                                    <span class="font-bold text-green-600" id="lowRiskTotal">€0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center space-x-2">
                                        <span class="risk-indicator risk-medium"></span>
                                        <span class="text-sm text-gray-600" data-translate="dashboard.medium_risk">Medium Risk</span>
                                    </div>
                                    <span class="font-bold text-yellow-600" id="mediumRiskTotal">€0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center space-x-2">
                                        <span class="risk-indicator risk-high"></span>
                                        <span class="text-sm text-gray-600" data-translate="dashboard.high_risk">High Risk</span>
                                    </div>
                                    <span class="font-bold text-red-600" id="highRiskTotal">€0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Capital Markets Tab -->
                <div id="capital-markets-content" class="tab-content">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900" data-translate="capital_markets.title">Capital Markets Portfolio</h3>
                            <button id="addCapitalMarketBtn" class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span data-translate="common.add_investment">Add Investment</span>
                            </button>
                        </div>
                        <div class="p-6" id="capitalMarketsContainer">
                            <div class="text-center text-gray-500 py-8">
                                <i data-lucide="bar-chart-3" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                <p data-translate="capital_markets.empty">No investments added yet</p>
                                <p class="text-sm" data-translate="capital_markets.empty_help">Click "Add Investment" to get started</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Real Estate Tab -->
                <div id="real-estate-content" class="tab-content">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900" data-translate="real_estate.title">Real Estate Portfolio</h3>
                            <button id="addRealEstateBtn" class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span data-translate="common.add_property">Add Property</span>
                            </button>
                        </div>
                        <div class="p-6" id="realEstateContainer">
                            <div class="text-center text-gray-500 py-8">
                                <i data-lucide="home" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                <p data-translate="real_estate.empty">No properties added yet</p>
                                <p class="text-sm" data-translate="real_estate.empty_help">Click "Add Property" to get started</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bank Accounts Tab -->
                <div id="bank-accounts-content" class="tab-content">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900" data-translate="bank_accounts.title">Bank Accounts</h3>
                            <button id="addBankAccountBtn" class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span data-translate="common.add_account">Add Account</span>
                            </button>
                        </div>
                        <div class="p-6" id="bankAccountsContainer">
                            <div class="text-center text-gray-500 py-8">
                                <i data-lucide="credit-card" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                <p data-translate="bank_accounts.empty">No accounts added yet</p>
                                <p class="text-sm" data-translate="bank_accounts.empty_help">Click "Add Account" to get started</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other Assets Tab -->
                <div id="other-assets-content" class="tab-content">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900" data-translate="other_assets.title">Other Assets</h3>
                            <button id="addOtherAssetBtn" class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span data-translate="common.add_asset">Add Asset</span>
                            </button>
                        </div>
                        <div class="p-6" id="otherAssetsContainer">
                            <div class="text-center text-gray-500 py-8">
                                <i data-lucide="package" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                <p data-translate="other_assets.empty">No other assets added yet</p>
                                <p class="text-sm" data-translate="other_assets.empty_help">Click "Add Asset" to get started</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Investments Overview Tab -->
                <div id="investments-overview-content" class="tab-content">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6" data-translate="investments_overview.title">Investments Overview</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg p-4">
                                <h4 class="font-medium text-blue-900 mb-2" data-translate="investments_overview.total_invested">Total Invested Capital</h4>
                                <p class="text-2xl font-bold text-blue-700" id="totalInvestedAmount">€0</p>
                            </div>
                            <div class="bg-gradient-to-r from-green-50 to-green-100 rounded-lg p-4">
                                <h4 class="font-medium text-green-900 mb-2" data-translate="investments_overview.growth_potential">Growth Potential</h4>
                                <p class="text-2xl font-bold text-green-700" id="growthPotentialAmount">€0</p>
                            </div>
                            <div class="bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg p-4">
                                <h4 class="font-medium text-purple-900 mb-2" data-translate="investments_overview.diversification">Diversification Score</h4>
                                <p class="text-2xl font-bold text-purple-700" id="diversificationScore">0%</p>
                            </div>
                        </div>

                        <div id="investmentsBreakdown">
                            <!-- Investments breakdown will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Liabilities Tab -->
                <div id="liabilities-content" class="tab-content">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900" data-translate="liabilities.title">Liabilities & Debts</h3>
                            <button id="addLiabilityBtn" class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span data-translate="common.add_liability">Add Liability</span>
                            </button>
                        </div>
                        <div class="p-6" id="liabilitiesContainer">
                            <div class="text-center text-gray-500 py-8">
                                <i data-lucide="minus-circle" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                <p data-translate="liabilities.empty">No liabilities added yet</p>
                                <p class="text-sm" data-translate="liabilities.empty_help">Click "Add Liability" to get started</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Income Tab -->
                <div id="income-content" class="tab-content">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900" data-translate="income.title">Income Sources</h3>
                            <button id="addIncomeBtn" class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span data-translate="common.add_income">Add Income</span>
                            </button>
                        </div>
                        <div class="p-6" id="incomeContainer">
                            <div class="text-center text-gray-500 py-8">
                                <i data-lucide="dollar-sign" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                <p data-translate="income.empty">No income sources added yet</p>
                                <p class="text-sm" data-translate="income.empty_help">Click "Add Income" to get started</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Expenses Tab -->
                <div id="expenses-content" class="tab-content">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-900" data-translate="expenses.title">Expenses</h3>
                            <button id="addExpenseBtn" class="flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                <i data-lucide="plus" class="w-4 h-4"></i>
                                <span data-translate="common.add_expense">Add Expense</span>
                            </button>
                        </div>
                        <div class="p-6" id="expensesContainer">
                            <div class="text-center text-gray-500 py-8">
                                <i data-lucide="receipt" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                <p data-translate="expenses.empty">No expenses added yet</p>
                                <p class="text-sm" data-translate="expenses.empty_help">Click "Add Expense" to get started</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cash Flow Analysis Tab -->
                <div id="cashflow-analysis-content" class="tab-content">
                    <div class="space-y-6">
                        <!-- Cash Flow Chart -->
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4" data-translate="cashflow.chart_title">Monthly Cash Flow Analysis</h3>
                            <div class="h-64">
                                <canvas id="cashFlowChart"></canvas>
                            </div>
                        </div>

                        <!-- Cash Flow Summary -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                                <h4 class="font-medium text-gray-900 mb-2" data-translate="cashflow.total_income">Total Monthly Income</h4>
                                <p class="text-2xl font-bold text-green-600" id="totalMonthlyIncome">€0</p>
                            </div>
                            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                                <h4 class="font-medium text-gray-900 mb-2" data-translate="cashflow.total_expenses">Total Monthly Expenses</h4>
                                <p class="text-2xl font-bold text-red-600" id="totalMonthlyExpenses">€0</p>
                            </div>
                            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                                <h4 class="font-medium text-gray-900 mb-2" data-translate="cashflow.net_flow">Net Cash Flow</h4>
                                <p class="text-2xl font-bold" id="netCashFlow">€0</p>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Universal Modal -->
    <div id="addModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900" id="modalTitle">Add Item</h3>
                    <button id="closeModal" class="text-gray-400 hover:text-gray-600">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6" id="modalBody">
                <!-- Form content will be inserted here -->
            </div>
            
            <div class="p-6 border-t border-gray-200 flex space-x-3">
                <button id="cancelModal" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors" data-translate="common.cancel">Cancel</button>
                <button id="saveModal" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors" data-translate="common.save">Save</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // 🌍 TRANSLATIONS
        const translations = {
            en: {
                'login.subtitle': 'Sign in to manage your finances',
                'login.google': 'Continue with Google',
                'login.demo': 'Continue in Demo Mode',
                'nav.dashboard': 'Dashboard & Analytics',
                'nav.assets': 'Assets',
                'nav.capital_markets': 'Capital Markets',
                'nav.real_estate': 'Real Estate',
                'nav.bank_accounts': 'Bank Accounts',
                'nav.other_assets': 'Other Assets',
                'nav.investments_overview': 'Investments Overview',
                'nav.liabilities': 'Liabilities',
                'nav.cash_flow': 'Cash Flow',
                'nav.income': 'Income',
                'nav.expenses': 'Expenses',
                'nav.cashflow_analysis': 'Cash Flow Analysis',
                'nav.logout': 'Logout',
                'dashboard.title': 'Dashboard & Analytics',
                'dashboard.subtitle': 'Welcome to your financial overview',
                'dashboard.net_worth': 'Net Worth',
                'dashboard.total_wealth': 'Total Wealth',
                'dashboard.total_assets': 'Total Assets',
                'dashboard.all_holdings': 'All Holdings',
                'dashboard.invested_capital': 'Invested Capital',
                'dashboard.growth_potential': 'Growth Potential',
                'dashboard.monthly_balance': 'Monthly Balance',
                'dashboard.income_minus_expenses': 'Income - Expenses',
                'dashboard.portfolio_breakdown': 'Portfolio Breakdown',
                'dashboard.capital_markets': 'Capital Markets',
                'dashboard.real_estate': 'Real Estate',
                'dashboard.bank_accounts': 'Bank Accounts',
                'dashboard.other_assets': 'Other Assets',
                'dashboard.total_liabilities': 'Total Liabilities',
                'dashboard.risk_analysis': 'Risk Analysis',
                'dashboard.low_risk': 'Low Risk',
                'dashboard.medium_risk': 'Medium Risk',
                'dashboard.high_risk': 'High Risk',
                'common.add_investment': 'Add Investment',
                'common.add_property': 'Add Property',
                'common.add_account': 'Add Account',
                'common.add_asset': 'Add Asset',
                'common.add_liability': 'Add Liability',
                'common.add_income': 'Add Income',
                'common.add_expense': 'Add Expense',
                'common.cancel': 'Cancel',
                'common.save': 'Save'
            },
            el: {
                'login.subtitle': 'Συνδεθείτε για να διαχειριστείτε τα οικονομικά σας',
                'login.google': 'Συνέχεια με Google',
                'login.demo': 'Συνέχεια σε δοκιμαστική λειτουργία',
                'nav.dashboard': 'Ταμπλό & Αναλυτικά',
                'nav.assets': 'Περιουσιακά Στοιχεία',
                'nav.capital_markets': 'Κεφαλαιαγορά',
                'nav.real_estate': 'Ακίνητα',
                'nav.bank_accounts': 'Τραπεζικοί Λογαριασμοί',
                'nav.other_assets': 'Άλλα Περιουσιακά',
                'nav.investments_overview': 'Επισκόπηση Επενδύσεων',
                'nav.liabilities': 'Υποχρεώσεις',
                'nav.cash_flow': 'Ταμειακές Ροές',
                'nav.income': 'Εισόδημα',
                'nav.expenses': 'Έξοδα',
                'nav.cashflow_analysis': 'Ανάλυση Ταμειακών Ροών',
                'nav.logout': 'Αποσύνδεση',
                'dashboard.title': 'Ταμπλό & Αναλυτικά',
                'dashboard.subtitle': 'Καλώς ήρθατε στην οικονομική σας επισκόπηση',
                'dashboard.net_worth': 'Καθαρή Περιουσία',
                'dashboard.total_wealth': 'Συνολικός Πλούτος',
                'dashboard.total_assets': 'Συνολικά Περιουσιακά',
                'dashboard.all_holdings': 'Όλες οι Συμμετοχές',
                'dashboard.invested_capital': 'Επενδυμένο Κεφάλαιο',
                'dashboard.growth_potential': 'Δυναμικό Ανάπτυξης',
                'dashboard.monthly_balance': 'Μηνιαίο Υπόλοιπο',
                'dashboard.income_minus_expenses': 'Εισόδημα - Έξοδα',
                'dashboard.portfolio_breakdown': 'Ανάλυση Χαρτοφυλακίου',
                'dashboard.capital_markets': 'Κεφαλαιαγορά',
                'dashboard.real_estate': 'Ακίνητα',
                'dashboard.bank_accounts': 'Τραπεζικοί Λογαριασμοί',
                'dashboard.other_assets': 'Άλλα Περιουσιακά',
                'dashboard.total_liabilities': 'Συνολικές Υποχρεώσεις',
                'dashboard.risk_analysis': 'Ανάλυση Κινδύνου',
                'dashboard.low_risk': 'Χαμηλός Κίνδυνος',
                'dashboard.medium_risk': 'Μέτριος Κίνδυνος',
                'dashboard.high_risk': 'Υψηλός Κίνδυνος',
                'common.add_investment': 'Προσθήκη Επένδυσης',
                'common.add_property': 'Προσθήκη Ακινήτου',
                'common.add_account': 'Προσθήκη Λογαριασμού',
                'common.add_asset': 'Προσθήκη Περιουσιακού',
                'common.add_liability': 'Προσθήκη Υποχρέωσης',
                'common.add_income': 'Προσθήκη Εισοδήματος',
                'common.add_expense': 'Προσθήκη Εξόδου',
                'common.cancel': 'Ακύρωση',
                'common.save': 'Αποθήκευση'
            }
        };

        // 🔥 FIREBASE CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyDOi3pkTY7Nof19auZkLzs4KnhJ8DTPqwI",
            authDomain: "wealth-tracker-app-4209f.firebaseapp.com",
            projectId: "wealth-tracker-app-4209f",
            storageBucket: "wealth-tracker-app-4209f.firebasestorage.app",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef123456"
        };

        // Initialize Firebase
        let auth, db, provider;
        try {
            firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            provider = new firebase.auth.GoogleAuthProvider();
            console.log('✅ Firebase initialized successfully');
        } catch (error) {
            console.log('⚠️ Firebase not available, using localStorage only');
        }

        // 📱 GLOBAL STATE
        let currentUser = null;
        let activeTab = 'dashboard';
        let currentCurrency = 'EUR';
        let isDemoMode = false;
        let currentLanguage = 'en';

        // 🌍 TRANSLATION SYSTEM
        function translate() {
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            document.getElementById('languageSelect').value = lang;
            translate();
            localStorage.setItem('preferred_language', lang);
        }

        // 🎯 DATA STORAGE SYSTEM
        class DataManager {
            static getStorageKey(type) {
                const prefix = isDemoMode ? 'demo_' : (currentUser ? currentUser.uid + '_' : 'local_');
                return prefix + type;
            }

            static async saveData(type, data) {
                console.log('💾 Saving data:', type, data);
                
                try {
                    if (!isDemoMode && currentUser && db) {
                        // Save to Firebase
                        const docRef = await db.collection('users').doc(currentUser.uid).collection(type).add(data);
                        data.id = docRef.id;
                        console.log('✅ Saved to Firebase:', type, data.id);
                    } else {
                        // Save to localStorage
                        const storageKey = this.getStorageKey(type);
                        const existingData = JSON.parse(localStorage.getItem(storageKey) || '[]');
                        data.id = Date.now().toString() + '_' + Math.random().toString(36).substr(2, 9);
                        existingData.push(data);
                        localStorage.setItem(storageKey, JSON.stringify(existingData));
                        console.log('✅ Saved to localStorage:', storageKey, data.id);
                    }
                    return data;
                } catch (error) {
                    console.error('❌ Error saving data:', error);
                    throw error;
                }
            }

            static async loadData(type) {
                console.log('📥 Loading data:', type);
                
                try {
                    if (!isDemoMode && currentUser && db) {
                        // Load from Firebase
                        const snapshot = await db.collection('users').doc(currentUser.uid).collection(type).get();
                        const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        console.log('✅ Loaded from Firebase:', type, data.length, 'items');
                        return data;
                    } else {
                        // Load from localStorage
                        const storageKey = this.getStorageKey(type);
                        const data = JSON.parse(localStorage.getItem(storageKey) || '[]');
                        console.log('✅ Loaded from localStorage:', storageKey, data.length, 'items');
                        return data;
                    }
                } catch (error) {
                    console.error('❌ Error loading data:', error);
                    return [];
                }
            }

            static async deleteData(type, id) {
                console.log('🗑️ Deleting data:', type, id);
                
                try {
                    if (!isDemoMode && currentUser && db) {
                        // Delete from Firebase
                        await db.collection('users').doc(currentUser.uid).collection(type).doc(id).delete();
                        console.log('✅ Deleted from Firebase:', type, id);
                    } else {
                        // Delete from localStorage
                        const storageKey = this.getStorageKey(type);
                        const existingData = JSON.parse(localStorage.getItem(storageKey) || '[]');
                        const filteredData = existingData.filter(item => item.id !== id);
                        localStorage.setItem(storageKey, JSON.stringify(filteredData));
                        console.log('✅ Deleted from localStorage:', storageKey, id);
                    }
                } catch (error) {
                    console.error('❌ Error deleting data:', error);
                    throw error;
                }
            }
        }

        // 🛠️ UTILITY FUNCTIONS
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-EU', {
                style: 'currency',
                currency: currentCurrency
            }).format(amount || 0);
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `px-6 py-3 rounded-lg text-white font-medium shadow-lg transform transition-all duration-300 ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            }`;
            toast.textContent = message;
            
            document.getElementById('toastContainer').appendChild(toast);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function createIcons() {
            if (typeof lucide !== 'undefined' && lucide.createIcons) {
                lucide.createIcons();
            }
        }

        // 🎮 NAVIGATION SYSTEM
        function switchTab(tabName) {
            console.log('🔄 Switching to tab:', tabName);
            activeTab = tabName;

            // Update navigation
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('text-gray-600');
            });

            document.querySelectorAll('.dropdown-item').forEach(item => {
                item.classList.remove('active');
            });

            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeBtn) {
                if (activeBtn.classList.contains('nav-item')) {
                    activeBtn.classList.add('active');
                    activeBtn.classList.remove('text-gray-600');
                } else if (activeBtn.classList.contains('dropdown-item')) {
                    activeBtn.classList.add('active');
                    // Also activate parent dropdown
                    const parentDropdown = activeBtn.closest('.relative').querySelector('.nav-item');
                    if (parentDropdown) {
                        parentDropdown.classList.add('active');
                        parentDropdown.classList.remove('text-gray-600');
                    }
                }
            }

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            const currentContent = document.getElementById(`${tabName}-content`);
            if (currentContent) {
                currentContent.classList.add('active');
            }

            // Update page title
            const titleMap = {
                'dashboard': 'Dashboard & Analytics',
                'capital-markets': 'Capital Markets',
                'real-estate': 'Real Estate',
                'bank-accounts': 'Bank Accounts',
                'other-assets': 'Other Assets',
                'investments-overview': 'Investments Overview',
                'liabilities': 'Liabilities',
                'income': 'Income',
                'expenses': 'Expenses',
                'cashflow-analysis': 'Cash Flow Analysis'
            };

            const title = titleMap[tabName] || tabName.charAt(0).toUpperCase() + tabName.slice(1).replace('-', ' ');
            document.getElementById('pageTitle').textContent = title;

            // Load data for this tab
            if (tabName !== 'dashboard') {
                renderTabContent(tabName);
            } else {
                updateDashboard();
            }
        }

        // 📋 MODAL SYSTEM
        function openModal(type) {
            console.log('🎯 Opening modal for:', type);
            
            const modal = document.getElementById('addModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            const modalConfigs = {
                'capital-markets': {
                    title: 'Add Capital Market Investment',
                    form: `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Investment Name</label>
                                <input type="text" id="form_name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Apple Stock, Bitcoin" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                <select id="form_type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="stock">Stock</option>
                                    <option value="etf">ETF</option>
                                    <option value="crypto">Cryptocurrency</option>
                                    <option value="bond">Bond</option>
                                    <option value="mutual_fund">Mutual Fund</option>
                                    <option value="life_insurance">Life Insurance</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
                                    <input type="number" id="form_quantity" step="0.001" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="100">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Purchase Price</label>
                                    <input type="number" id="form_purchase_price" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="150.00">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Current Value (optional)</label>
                                <input type="number" id="form_current_value" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="15500.00">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Monthly Investment (for life insurance)</label>
                                <input type="number" id="form_monthly_investment" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="600">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Risk Level</label>
                                <select id="form_risk_level" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="low">Low Risk</option>
                                    <option value="medium">Medium Risk</option>
                                    <option value="high">High Risk</option>
                                </select>
                            </div>
                        </div>
                    `
                },
                'real-estate': {
                    title: 'Add Real Estate Property',
                    form: `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Property Name</label>
                                <input type="text" id="form_name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Downtown Apartment" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                <select id="form_type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="residential">Residential</option>
                                    <option value="commercial">Commercial</option>
                                    <option value="land">Land</option>
                                    <option value="rental">Rental Property</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Purchase Price</label>
                                <input type="number" id="form_purchase_price" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="250000" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Current Value</label>
                                <input type="number" id="form_current_value" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="270000">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Monthly Rental Income (if applicable)</label>
                                <input type="number" id="form_monthly_rental" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1200">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                                <input type="text" id="form_location" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Athens, Greece">
                            </div>
                        </div>
                    `
                },
                'bank-accounts': {
                    title: 'Add Bank Account',
                    form: `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Account Name</label>
                                <input type="text" id="form_name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Main Checking Account" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Bank</label>
                                <input type="text" id="form_bank" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., National Bank">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Account Type</label>
                                <select id="form_type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="checking">Checking</option>
                                    <option value="savings">Savings</option>
                                    <option value="deposit">Term Deposit</option>
                                    <option value="business">Business</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Current Balance</label>
                                <input type="number" id="form_balance" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="5000" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Interest Rate (%)</label>
                                <input type="number" id="form_interest_rate" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="2.5">
                            </div>
                            <div id="termDepositFields" class="space-y-4 hidden">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Lock Period (months)</label>
                                    <input type="number" id="form_lock_period" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="12">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Maturity Date</label>
                                    <input type="date" id="form_maturity_date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                        </div>
                    `
                },
                'other-assets': {
                    title: 'Add Other Asset',
                    form: `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Asset Name</label>
                                <input type="text" id="form_name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Gold, Art, Vehicle" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                <select id="form_category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="precious_metals">Precious Metals</option>
                                    <option value="art_collectibles">Art & Collectibles</option>
                                    <option value="vehicles">Vehicles</option>
                                    <option value="business_assets">Business Assets</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Purchase Price</label>
                                <input type="number" id="form_purchase_price" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="10000" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Current Value</label>
                                <input type="number" id="form_current_value" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="12000">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea id="form_description" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Additional details about this asset"></textarea>
                            </div>
                        </div>
                    `
                },
                'liabilities': {
                    title: 'Add Liability/Debt',
                    form: `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Liability Name</label>
                                <input type="text" id="form_name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Home Mortgage" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                <select id="form_type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="mortgage">Mortgage</option>
                                    <option value="loan">Personal Loan</option>
                                    <option value="credit_card">Credit Card</option>
                                    <option value="student_loan">Student Loan</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Outstanding Balance</label>
                                <input type="number" id="form_balance" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="150000" required>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Interest Rate (%)</label>
                                    <input type="number" id="form_interest_rate" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="3.5">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Monthly Payment</label>
                                    <input type="number" id="form_monthly_payment" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1200">
                                </div>
                            </div>
                        </div>
                    `
                },
                'income': {
                    title: 'Add Income Source',
                    form: `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Income Source</label>
                                <input type="text" id="form_name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Salary, Freelance" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                <select id="form_type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="salary">Salary</option>
                                    <option value="freelance">Freelance</option>
                                    <option value="business">Business</option>
                                    <option value="rental">Rental Income</option>
                                    <option value="dividends">Dividends</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Monthly Amount</label>
                                <input type="number" id="form_monthly_amount" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="3500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">After Tax Amount</label>
                                <input type="number" id="form_after_tax_amount" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="2800">
                            </div>
                        </div>
                    `
                },
                'expenses': {
                    title: 'Add Expense',
                    form: `
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Expense Description</label>
                                <input type="text" id="form_name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Groceries, Rent" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                <select id="form_category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="housing">Housing</option>
                                    <option value="food">Food & Dining</option>
                                    <option value="transportation">Transportation</option>
                                    <option value="utilities">Utilities</option>
                                    <option value="entertainment">Entertainment</option>
                                    <option value="health">Health</option>
                                    <option value="shopping">Shopping</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Amount</label>
                                <input type="number" id="form_amount" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="250" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Frequency</label>
                                <select id="form_frequency" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="monthly">Monthly</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="daily">Daily</option>
                                    <option value="yearly">Yearly</option>
                                    <option value="one-time">One-time</option>
                                </select>
                            </div>
                        </div>
                    `
                }
            };

            const config = modalConfigs[type];
            if (!config) {
                showToast('Unknown item type', 'error');
                return;
            }

            modalTitle.textContent = config.title;
            modalBody.innerHTML = config.form;
            modal.setAttribute('data-type', type);
            modal.classList.remove('hidden');

            // Setup special field handlers
            if (type === 'bank-accounts') {
                const typeSelect = document.getElementById('form_type');
                const termDepositFields = document.getElementById('termDepositFields');
                
                typeSelect.addEventListener('change', function() {
                    if (this.value === 'deposit') {
                        termDepositFields.classList.remove('hidden');
                    } else {
                        termDepositFields.classList.add('hidden');
                    }
                });
            }

            // Focus first input
            setTimeout(() => {
                const firstInput = modalBody.querySelector('input');
                if (firstInput) firstInput.focus();
            }, 100);

            console.log('✅ Modal opened for:', type);
        }

        function closeModal() {
            const modal = document.getElementById('addModal');
            modal.classList.add('hidden');
            modal.removeAttribute('data-type');
        }

        // 💾 SAVE SYSTEM
        async function saveModalData() {
            const modal = document.getElementById('addModal');
            const saveBtn = document.getElementById('saveModal');
            const type = modal.getAttribute('data-type');

            if (!type) {
                showToast('Error: No item type specified', 'error');
                return;
            }

            // Show loading state
            const originalText = saveBtn.textContent;
            saveBtn.textContent = 'Saving...';
            saveBtn.disabled = true;

            try {
                console.log('💾 Collecting form data for:', type);

                // Collect form data
                const formData = {
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                // Get form values based on type
                const nameField = document.getElementById('form_name');
                if (!nameField || !nameField.value.trim()) {
                    throw new Error('Please enter a name');
                }
                formData.name = nameField.value.trim();

                // Type-specific field collection
                switch (type) {
                    case 'capital-markets':
                        formData.type = document.getElementById('form_type').value;
                        formData.quantity = parseFloat(document.getElementById('form_quantity').value) || 0;
                        formData.purchasePrice = parseFloat(document.getElementById('form_purchase_price').value) || 0;
                        formData.currentValue = parseFloat(document.getElementById('form_current_value').value) || null;
                        formData.monthlyInvestment = parseFloat(document.getElementById('form_monthly_investment').value) || 0;
                        formData.riskLevel = document.getElementById('form_risk_level').value;
                        break;

                    case 'real-estate':
                        formData.type = document.getElementById('form_type').value;
                        formData.purchasePrice = parseFloat(document.getElementById('form_purchase_price').value) || 0;
                        formData.currentValue = parseFloat(document.getElementById('form_current_value').value) || formData.purchasePrice;
                        formData.monthlyRental = parseFloat(document.getElementById('form_monthly_rental').value) || 0;
                        formData.location = document.getElementById('form_location').value || '';
                        break;

                    case 'bank-accounts':
                        formData.bank = document.getElementById('form_bank').value || '';
                        formData.type = document.getElementById('form_type').value;
                        formData.balance = parseFloat(document.getElementById('form_balance').value) || 0;
                        formData.interestRate = parseFloat(document.getElementById('form_interest_rate').value) || 0;
                        if (formData.type === 'deposit') {
                            formData.lockPeriod = parseInt(document.getElementById('form_lock_period').value) || 0;
                            formData.maturityDate = document.getElementById('form_maturity_date').value || '';
                        }
                        break;

                    case 'other-assets':
                        formData.category = document.getElementById('form_category').value;
                        formData.purchasePrice = parseFloat(document.getElementById('form_purchase_price').value) || 0;
                        formData.currentValue = parseFloat(document.getElementById('form_current_value').value) || formData.purchasePrice;
                        formData.description = document.getElementById('form_description').value || '';
                        break;

                    case 'liabilities':
                        formData.type = document.getElementById('form_type').value;
                        formData.balance = parseFloat(document.getElementById('form_balance').value) || 0;
                        formData.interestRate = parseFloat(document.getElementById('form_interest_rate').value) || 0;
                        formData.monthlyPayment = parseFloat(document.getElementById('form_monthly_payment').value) || 0;
                        break;

                    case 'income':
                        formData.type = document.getElementById('form_type').value;
                        formData.monthlyAmount = parseFloat(document.getElementById('form_monthly_amount').value) || 0;
                        formData.afterTaxAmount = parseFloat(document.getElementById('form_after_tax_amount').value) || formData.monthlyAmount;
                        break;

                    case 'expenses':
                        formData.category = document.getElementById('form_category').value;
                        formData.amount = parseFloat(document.getElementById('form_amount').value) || 0;
                        formData.frequency = document.getElementById('form_frequency').value;
                        break;
                }

                console.log('📝 Form data collected:', formData);

                // Save data
                const savedData = await DataManager.saveData(type, formData);
                console.log('✅ Data saved successfully:', savedData);

                showToast(`${type.replace('-', ' ')} added successfully!`, 'success');
                closeModal();
                
                // Refresh current view
                if (activeTab === 'dashboard') {
                    await updateDashboard();
                } else {
                    await renderTabContent(activeTab);
                }

            } catch (error) {
                console.error('❌ Error saving data:', error);
                showToast(error.message || 'Error saving item', 'error');
            } finally {
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
            }
        }

        // 📊 DATA RENDERING SYSTEM
        async function renderTabContent(tabName) {
            console.log('🎨 Rendering content for:', tabName);
            
            // Handle special tabs
            if (tabName === 'investments-overview') {
                await renderInvestmentsOverview();
                return;
            }
            
            if (tabName === 'cashflow-analysis') {
                await renderCashFlowAnalysis();
                return;
            }
            
            const data = await DataManager.loadData(tabName);
            const containerMap = {
                'capital-markets': 'capitalMarketsContainer',
                'real-estate': 'realEstateContainer',
                'bank-accounts': 'bankAccountsContainer',
                'other-assets': 'otherAssetsContainer',
                'liabilities': 'liabilitiesContainer',
                'income': 'incomeContainer',
                'expenses': 'expensesContainer'
            };
            
            const containerId = containerMap[tabName];
            const container = document.getElementById(containerId);

            if (!container) {
                console.warn('Container not found:', containerId);
                return;
            }

            if (data.length === 0) {
                // Show empty state
                const iconMap = {
                    'capital-markets': 'bar-chart-3',
                    'real-estate': 'home',
                    'bank-accounts': 'credit-card',
                    'other-assets': 'package',
                    'liabilities': 'minus-circle',
                    'income': 'dollar-sign',
                    'expenses': 'receipt'
                };

                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i data-lucide="${iconMap[tabName]}" class="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                        <p>No ${tabName.replace('-', ' ')} added yet</p>
                        <p class="text-sm">Click "Add" to get started</p>
                    </div>
                `;
                createIcons();
                return;
            }

            // Render data items
            let itemsHtml = '<div class="space-y-4">';
            
            data.forEach(item => {
                let valueDisplay = '';
                let detailsDisplay = '';
                let riskIndicator = '';

                switch (tabName) {
                    case 'capital-markets':
                        const totalValue = item.currentValue || (item.quantity * item.purchasePrice) || item.monthlyInvestment * 12;
                        valueDisplay = formatCurrency(totalValue);
                        detailsDisplay = `${item.type}`;
                        if (item.quantity > 0) detailsDisplay += ` • ${item.quantity} shares`;
                        if (item.monthlyInvestment > 0) detailsDisplay += ` • ${formatCurrency(item.monthlyInvestment)}/month`;
                        riskIndicator = `<span class="risk-indicator risk-${item.riskLevel}"></span>`;
                        break;
                    case 'real-estate':
                        valueDisplay = formatCurrency(item.currentValue || item.purchasePrice);
                        detailsDisplay = `${item.type} ${item.location ? '• ' + item.location : ''}`;
                        if (item.monthlyRental > 0) detailsDisplay += ` • ${formatCurrency(item.monthlyRental)}/month`;
                        break;
                    case 'bank-accounts':
                        valueDisplay = formatCurrency(item.balance);
                        detailsDisplay = `${item.bank} • ${item.type}`;
                        if (item.interestRate > 0) detailsDisplay += ` • ${item.interestRate}% APY`;
                        if (item.lockPeriod > 0) detailsDisplay += ` • ${item.lockPeriod} months lock`;
                        break;
                    case 'other-assets':
                        valueDisplay = formatCurrency(item.currentValue || item.purchasePrice);
                        detailsDisplay = `${item.category}`;
                        if (item.description) detailsDisplay += ` • ${item.description}`;
                        break;
                    case 'liabilities':
                        valueDisplay = formatCurrency(item.balance);
                        detailsDisplay = `${item.type}`;
                        if (item.interestRate > 0) detailsDisplay += ` • ${item.interestRate}%`;
                        if (item.monthlyPayment > 0) detailsDisplay += ` • ${formatCurrency(item.monthlyPayment)}/month`;
                        break;
                    case 'income':
                        valueDisplay = formatCurrency(item.afterTaxAmount || item.monthlyAmount);
                        detailsDisplay = `${item.type} • Monthly`;
                        break;
                    case 'expenses':
                        valueDisplay = formatCurrency(item.amount);
                        detailsDisplay = `${item.category} • ${item.frequency}`;
                        break;
                }

                itemsHtml += `
                    <div class="bg-gray-50 rounded-lg p-4 flex justify-between items-center hover:bg-gray-100 transition-colors">
                        <div class="flex items-center space-x-3">
                            ${riskIndicator}
                            <div>
                                <h4 class="font-medium text-gray-900">${item.name}</h4>
                                <p class="text-sm text-gray-500">${detailsDisplay}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-gray-900">${valueDisplay}</p>
                            <div class="flex space-x-2 mt-1">
                                <button onclick="deleteItem('${tabName}', '${item.id}')" class="text-red-600 hover:text-red-800 text-sm font-medium">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            itemsHtml += '</div>';
            container.innerHTML = itemsHtml;

            console.log('✅ Rendered', data.length, 'items for', tabName);
        }

        // 🗑️ DELETE FUNCTION
        window.deleteItem = async function(type, id) {
            if (!confirm('Are you sure you want to delete this item?')) return;
            
            try {
                await DataManager.deleteData(type, id);
                showToast('Item deleted successfully!', 'success');
                
                if (activeTab === 'dashboard') {
                    await updateDashboard();
                } else {
                    await renderTabContent(activeTab);
                }
            } catch (error) {
                console.error('❌ Error deleting item:', error);
                showToast('Error deleting item', 'error');
            }
        };

        // 📈 CALCULATE INVESTED CAPITAL
        async function calculateInvestedCapital() {
            const [capitalMarkets, realEstate, bankAccounts] = await Promise.all([
                DataManager.loadData('capital-markets'),
                DataManager.loadData('real-estate'),
                DataManager.loadData('bank-accounts')
            ]);

            let investedCapital = 0;

            // All capital markets investments are considered invested
            capitalMarkets.forEach(item => {
                const value = item.currentValue || (item.quantity * item.purchasePrice) || (item.monthlyInvestment * 12);
                investedCapital += value || 0;
            });

            // All real estate is considered invested
            realEstate.forEach(item => {
                investedCapital += item.currentValue || item.purchasePrice || 0;
            });

            // Bank accounts with interest are considered invested
            bankAccounts.forEach(item => {
                if (item.interestRate > 0) {
                    investedCapital += item.balance || 0;
                }
            });

            return investedCapital;
        }

        // 📊 INVESTMENTS OVERVIEW
        async function renderInvestmentsOverview() {
            const investedCapital = await calculateInvestedCapital();
            
            const [capitalMarkets, realEstate, bankAccounts] = await Promise.all([
                DataManager.loadData('capital-markets'),
                DataManager.loadData('real-estate'),
                DataManager.loadData('bank-accounts')
            ]);

            // Update totals
            document.getElementById('totalInvestedAmount').textContent = formatCurrency(investedCapital);
            document.getElementById('growthPotentialAmount').textContent = formatCurrency(investedCapital * 0.07); // Estimated 7% growth
            
            // Calculate diversification score
            let assetTypes = 0;
            if (capitalMarkets.length > 0) assetTypes++;
            if (realEstate.length > 0) assetTypes++;
            if (bankAccounts.filter(acc => acc.interestRate > 0).length > 0) assetTypes++;
            
            const diversificationScore = Math.min(100, (assetTypes / 3) * 100);
            document.getElementById('diversificationScore').textContent = diversificationScore.toFixed(0) + '%';

            // Render breakdown
            const breakdown = document.getElementById('investmentsBreakdown');
            let breakdownHtml = '<div class="space-y-4">';

            if (capitalMarkets.length > 0) {
                breakdownHtml += '<div class="border rounded-lg p-4"><h4 class="font-medium mb-2">Capital Markets</h4><div class="space-y-2">';
                capitalMarkets.forEach(item => {
                    const value = item.currentValue || (item.quantity * item.purchasePrice) || (item.monthlyInvestment * 12);
                    breakdownHtml += `
                        <div class="flex justify-between text-sm">
                            <span>${item.name}</span>
                            <span>${formatCurrency(value)}</span>
                        </div>
                    `;
                });
                breakdownHtml += '</div></div>';
            }

            if (realEstate.length > 0) {
                breakdownHtml += '<div class="border rounded-lg p-4"><h4 class="font-medium mb-2">Real Estate</h4><div class="space-y-2">';
                realEstate.forEach(item => {
                    const value = item.currentValue || item.purchasePrice;
                    breakdownHtml += `
                        <div class="flex justify-between text-sm">
                            <span>${item.name}</span>
                            <span>${formatCurrency(value)}</span>
                        </div>
                    `;
                });
                breakdownHtml += '</div></div>';
            }

            const interestBearingAccounts = bankAccounts.filter(acc => acc.interestRate > 0);
            if (interestBearingAccounts.length > 0) {
                breakdownHtml += '<div class="border rounded-lg p-4"><h4 class="font-medium mb-2">Interest-Bearing Accounts</h4><div class="space-y-2">';
                interestBearingAccounts.forEach(item => {
                    breakdownHtml += `
                        <div class="flex justify-between text-sm">
                            <span>${item.name}</span>
                            <span>${formatCurrency(item.balance)}</span>
                        </div>
                    `;
                });
                breakdownHtml += '</div></div>';
            }

            breakdownHtml += '</div>';
            breakdown.innerHTML = breakdownHtml;
        }

        // 📊 CASH FLOW ANALYSIS
        async function renderCashFlowAnalysis() {
            const [income, expenses] = await Promise.all([
                DataManager.loadData('income'),
                DataManager.loadData('expenses')
            ]);

            let totalMonthlyIncome = 0;
            let totalMonthlyExpenses = 0;

            // Calculate monthly income
            income.forEach(item => {
                totalMonthlyIncome += item.afterTaxAmount || item.monthlyAmount || 0;
            });

            // Calculate monthly expenses
            expenses.forEach(item => {
                let monthlyAmount = item.amount || 0;
                if (item.frequency === 'weekly') monthlyAmount *= 4.33;
                else if (item.frequency === 'yearly') monthlyAmount /= 12;
                else if (item.frequency === 'daily') monthlyAmount *= 30;
                totalMonthlyExpenses += monthlyAmount;
            });

            const netCashFlow = totalMonthlyIncome - totalMonthlyExpenses;

            // Update summary cards
            document.getElementById('totalMonthlyIncome').textContent = formatCurrency(totalMonthlyIncome);
            document.getElementById('totalMonthlyExpenses').textContent = formatCurrency(totalMonthlyExpenses);
            document.getElementById('netCashFlow').textContent = formatCurrency(netCashFlow);
            document.getElementById('netCashFlow').className = `text-2xl font-bold ${netCashFlow >= 0 ? 'text-green-600' : 'text-red-600'}`;

            // Create chart
            const ctx = document.getElementById('cashFlowChart');
            if (ctx) {
                // Destroy existing chart if it exists
                if (window.cashFlowChartInstance) {
                    window.cashFlowChartInstance.destroy();
                }

                window.cashFlowChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Income', 'Expenses', 'Net Flow'],
                        datasets: [{
                            label: 'Amount (€)',
                            data: [totalMonthlyIncome, totalMonthlyExpenses, netCashFlow],
                            backgroundColor: [
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(239, 68, 68, 0.8)',
                                netCashFlow >= 0 ? 'rgba(59, 130, 246, 0.8)' : 'rgba(239, 68, 68, 0.8)'
                            ],
                            borderColor: [
                                'rgb(34, 197, 94)',
                                'rgb(239, 68, 68)',
                                netCashFlow >= 0 ? 'rgb(59, 130, 246)' : 'rgb(239, 68, 68)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '€' + value.toLocaleString();
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return '€' + context.parsed.y.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        // 📈 DASHBOARD UPDATE SYSTEM
        async function updateDashboard() {
            console.log('📊 Updating dashboard...');
            
            try {
                // Load all data
                const [capitalMarkets, realEstate, bankAccounts, otherAssets, liabilities, income, expenses] = await Promise.all([
                    DataManager.loadData('capital-markets'),
                    DataManager.loadData('real-estate'),
                    DataManager.loadData('bank-accounts'),
                    DataManager.loadData('other-assets'),
                    DataManager.loadData('liabilities'),
                    DataManager.loadData('income'),
                    DataManager.loadData('expenses')
                ]);

                // Calculate totals
                let totalCapitalMarkets = 0;
                let totalRealEstate = 0;
                let totalBankAccounts = 0;
                let totalOtherAssets = 0;
                let totalLiabilities = 0;
                let monthlyIncome = 0;
                let monthlyExpenses = 0;

                // Risk analysis
                let lowRiskTotal = 0;
                let mediumRiskTotal = 0;
                let highRiskTotal = 0;

                // Capital Markets
                capitalMarkets.forEach(item => {
                    const value = item.currentValue || (item.quantity * item.purchasePrice) || (item.monthlyInvestment * 12);
                    totalCapitalMarkets += value || 0;

                    // Risk analysis
                    if (item.riskLevel === 'low') lowRiskTotal += value || 0;
                    else if (item.riskLevel === 'medium') mediumRiskTotal += value || 0;
                    else if (item.riskLevel === 'high') highRiskTotal += value || 0;
                });

                // Real Estate
                realEstate.forEach(item => {
                    const value = item.currentValue || item.purchasePrice || 0;
                    totalRealEstate += value;
                    mediumRiskTotal += value; // Real estate considered medium risk
                });

                // Bank Accounts
                bankAccounts.forEach(item => {
                    const value = item.balance || 0;
                    totalBankAccounts += value;
                    lowRiskTotal += value; // Bank accounts considered low risk
                });

                // Other Assets
                otherAssets.forEach(item => {
                    const value = item.currentValue || item.purchasePrice || 0;
                    totalOtherAssets += value;
                    mediumRiskTotal += value; // Other assets considered medium risk
                });

                // Liabilities
                liabilities.forEach(item => {
                    totalLiabilities += item.balance || 0;
                });

                // Income
                income.forEach(item => {
                    monthlyIncome += item.afterTaxAmount || item.monthlyAmount || 0;
                });

                // Expenses
                expenses.forEach(item => {
                    let monthlyAmount = item.amount || 0;
                    if (item.frequency === 'weekly') monthlyAmount *= 4.33;
                    else if (item.frequency === 'yearly') monthlyAmount /= 12;
                    else if (item.frequency === 'daily') monthlyAmount *= 30;
                    monthlyExpenses += monthlyAmount;
                });

                const totalAssets = totalCapitalMarkets + totalRealEstate + totalBankAccounts + totalOtherAssets;
                const netWorth = totalAssets - totalLiabilities;
                const monthlyBalance = monthlyIncome - monthlyExpenses;
                const investedCapital = await calculateInvestedCapital();

                // Update main dashboard values
                document.getElementById('netWorthValue').textContent = formatCurrency(netWorth);
                document.getElementById('totalAssetsValue').textContent = formatCurrency(totalAssets);
                document.getElementById('investedCapitalValue').textContent = formatCurrency(investedCapital);
                document.getElementById('monthlyBalanceValue').textContent = formatCurrency(monthlyBalance);

                // Update portfolio breakdown
                document.getElementById('capitalMarketsTotal').textContent = formatCurrency(totalCapitalMarkets);
                document.getElementById('realEstateTotal').textContent = formatCurrency(totalRealEstate);
                document.getElementById('bankAccountsTotal').textContent = formatCurrency(totalBankAccounts);
                document.getElementById('otherAssetsTotal').textContent = formatCurrency(totalOtherAssets);
                document.getElementById('liabilitiesTotal').textContent = formatCurrency(totalLiabilities);

                // Update risk analysis
                document.getElementById('lowRiskTotal').textContent = formatCurrency(lowRiskTotal);
                document.getElementById('mediumRiskTotal').textContent = formatCurrency(mediumRiskTotal);
                document.getElementById('highRiskTotal').textContent = formatCurrency(highRiskTotal);

                console.log('✅ Dashboard updated:', {
                    netWorth, totalAssets, monthlyBalance, investedCapital,
                    breakdown: { totalCapitalMarkets, totalRealEstate, totalBankAccounts, totalOtherAssets, totalLiabilities }
                });

            } catch (error) {
                console.error('❌ Error updating dashboard:', error);
            }
        }

        // 🔐 AUTHENTICATION SYSTEM
        async function signInWithGoogle() {
            try {
                console.log('🔄 Attempting Google sign-in...');
                const result = await auth.signInWithPopup(provider);
                console.log('✅ Google sign-in successful:', result.user.email);
                showToast('Successfully signed in with Google!', 'success');
            } catch (error) {
                console.error('❌ Google sign-in error:', error);
                showToast('Error signing in: ' + error.message, 'error');
            }
        }

        function enterDemoMode() {
            console.log('🎯 Entering demo mode');
            isDemoMode = true;
            currentUser = { uid: 'demo', email: 'demo@example.com' };
            showToast('Demo mode activated!', 'success');
            showApp();
            updateDashboard();
        }

        function signOut() {
            if (isDemoMode) {
                isDemoMode = false;
                currentUser = null;
                showLogin();
                showToast('Demo mode ended', 'success');
            } else if (auth) {
                auth.signOut().then(() => {
                    console.log('✅ User signed out');
                    showToast('Signed out successfully', 'success');
                }).catch((error) => {
                    console.error('❌ Sign out error:', error);
                    showToast('Error signing out', 'error');
                });
            }
        }

        function showApp() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
        }

        function showLogin() {
            document.getElementById('app').classList.add('hidden');
            document.getElementById('loginModal').classList.remove('hidden');
        }

        // 🚀 INITIALIZATION
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('🚀 WealthTracker Pro starting...');

            try {
                // Initialize Lucide icons
                createIcons();

                // Load preferred language
                const savedLanguage = localStorage.getItem('preferred_language') || 'en';
                setLanguage(savedLanguage);

                // Setup Language Toggle
                document.getElementById('languageSelect').addEventListener('change', function() {
                    setLanguage(this.value);
                });

                // Setup Navigation
                document.querySelectorAll('.nav-item').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const tabName = btn.getAttribute('data-tab');
                        if (tabName) {
                            switchTab(tabName);
                        }
                    });
                });

                // Setup Dropdown Navigation
                document.querySelectorAll('.dropdown-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const tabName = item.getAttribute('data-tab');
                        if (tabName) {
                            switchTab(tabName);
                            // Hide dropdown
                            item.closest('.dropdown-menu').classList.remove('active');
                        }
                    });
                });

                // Setup Dropdown Toggles
                document.getElementById('assetsDropdown').addEventListener('click', function() {
                    const menu = document.getElementById('assetsDropdownMenu');
                    menu.classList.toggle('active');
                    document.getElementById('cashflowDropdownMenu').classList.remove('active');
                });

                document.getElementById('cashflowDropdown').addEventListener('click', function() {
                    const menu = document.getElementById('cashflowDropdownMenu');
                    menu.classList.toggle('active');
                    document.getElementById('assetsDropdownMenu').classList.remove('active');
                });

                // Close dropdowns when clicking outside
                document.addEventListener('click', function(e) {
                    if (!e.target.closest('.relative')) {
                        document.querySelectorAll('.dropdown-menu').forEach(menu => {
                            menu.classList.remove('active');
                        });
                    }
                });

                // Setup Authentication
                if (auth) {
                    auth.onAuthStateChanged((user) => {
                        currentUser = user;
                        if (user && !isDemoMode) {
                            console.log('✅ User authenticated:', user.email);
                            showApp();
                            updateDashboard();
                        } else if (!isDemoMode) {
                            console.log('🔐 No user authenticated');
                            showLogin();
                        }
                    });
                }

                document.getElementById('googleSignInBtn').addEventListener('click', signInWithGoogle);
                document.getElementById('demoModeBtn').addEventListener('click', enterDemoMode);
                document.getElementById('logoutBtn').addEventListener('click', signOut);

                // Setup Modal System
                document.getElementById('closeModal').addEventListener('click', closeModal);
                document.getElementById('cancelModal').addEventListener('click', closeModal);
                document.getElementById('saveModal').addEventListener('click', saveModalData);

                // Setup Add Buttons
                document.getElementById('addCapitalMarketBtn').addEventListener('click', () => openModal('capital-markets'));
                document.getElementById('addRealEstateBtn').addEventListener('click', () => openModal('real-estate'));
                document.getElementById('addBankAccountBtn').addEventListener('click', () => openModal('bank-accounts'));
                document.getElementById('addOtherAssetBtn').addEventListener('click', () => openModal('other-assets'));
                document.getElementById('addLiabilityBtn').addEventListener('click', () => openModal('liabilities'));
                document.getElementById('addIncomeBtn').addEventListener('click', () => openModal('income'));
                document.getElementById('addExpenseBtn').addEventListener('click', () => openModal('expenses'));

                console.log('✅ Event listeners attached');

                // Hide loading screen
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    if (!auth) {
                        showLogin();
                    }
                }, 1500);

            } catch (error) {
                console.error('❌ Initialization error:', error);
                showToast('Error initializing app: ' + error.message, 'error');
            }
        });

        console.log('🎯 WealthTracker Pro script loaded successfully!');
    </script>
</body>
</html>
